# Проектная работа по аналитическим базам данных

## Задача проекта

Помочь маркетологам дать эффективную рекламу соцсети в интернете, чтобы привлечь новых пользователей.

## Описание задачи

Чтобы привлечь новых пользователей, маркетологи хотят разместить на сторонних сайтах рекламу сообществ с высокой
активностью. Для этого нужно определить группы, в которых начала общаться большая часть их участников.

Необходимо:

1. Перенести из S3 в staging-слой новые данные о входе и выходе пользователей из групп — файл group_log.csv.
2. Создать в слое постоянного хранения таблицы для новых данных.
3. Перенести новые данные из staging-области в слой DDS.
4. Рассчитать конверсионные показатели для десяти самых старых групп:
5. количество пользователей, вступивших в группу, — cnt_added_users;
6. количество участников группы, которые написали хотя бы одно сообщение, — cnt_users_in_group_with_messages;
7. конверсию в первое сообщение из вступления в группу — group_conversion.

Лог работы групп group_log.csv содержит:

1. **group_id** — уникальный идентификатор группы;
2. **user_id** — уникальный идентификатор пользователя;
3. **user_id_from** — поле для отметки о том, что пользователь не сам вступил в группу, а его добавил другой участник.
   Если
   пользователя пригласил в группу кто-то другой, поле будет непустым.
4. **event** — действие, которое совершено пользователем user_id. Возможны следующие варианты:
    - **create** — пользователь создал группу;
    - **add** — пользователь user_id вступил сам или был добавлен в группу;
    - **leave** — пользователь user_id покинул группу.
5. **datetime** — время совершения event.

## Описание данных

### Stage

**group_log** – содержит данные из файла group_log.csv

1. **id** - суррогатный ключ записи лога.
2. **group_id** — уникальный идентификатор группы;
3. **user_id** — уникальный идентификатор пользователя;
4. **user_id_from** — поле для отметки о том, что пользователь не сам вступил в группу, а его добавил другой участник.
5. **event** — действие, которое совершено пользователем user_id.
6. **datetime** — время совершения event.

### DWH

#### Хабы

**h_group_logs** - сущность записи лога

1. **hk_group_log_id** - хеш ключ записи
2. **group_log_id** - идентификатор из таблицы group_log,
3. **datetime** - дата и время записи лога,
4. **load_dt** - дата и время загрузки записи,
5. **load_src** - информация об источнике данных.

#### Линки

**l_group_logs_users** - связь записи лога с пользователем

1. **hk_l_group_logs_users** - хеш ключ записи
2. **hk_group_log_id** - хеш ключ хаба h_group_logs,
3. **hk_user_id** - хеш ключ хаба пользователи,
4. **load_dt** - дата и время загрузки записи,
5. **load_src** - информация об источнике данных.

**l_group_logs_groups** - связь записи лога с группой

1. **hk_l_group_logs_groups** - хеш ключ записи
2. **hk_group_log_id** - хеш ключ хаба h_group_logs,
3. **hk_group_id** - хеш ключ хаба группы,
4. **load_dt** - дата и время загрузки записи,
5. **load_src** - информация об источнике данных.

**l_group_logs_users_from** - связь записи лога с пользователем пригласившим участника (user_id_from)

1. **hk_l_group_logs_users_from** - хеш ключ записи
2. **hk_group_log_id** - хеш ключ хаба h_group_logs,
3. **hk_user_id** - хеш ключ хаба пользователи (user_id_from),
4. **load_dt** - дата и время загрузки записи,
5. **load_src** - информация об источнике данных.

#### Сателлиты

**s_auth_history** - 

1. **hk_group_log_id** - хеш ключ хаба h_group_logs
2. **user_id_from** - идентификатор пользователя пригласившего участника,
3. **event** - действие, которое совершено пользователем,
4. **event_dt** - время события,
4. **load_dt** - дата и время загрузки записи,
5. **load_src** - информация об источнике данных.

### ETL

Порядок работы ETL скрипта:
1. Загружаются csv файлы из хранилища S3 в локальную файловую систему оркестратора;
2. В лог оркестратора выводятся по 10 строк каждого загруженного файла;
3. csv файлы загружаются в соответствующие таблицы stage слоя;
4. Из stage слоя загружаются таблицы хабов, генерируются хеш идентификаторы хабов;
5. Из stage и таблиц хабов загружаются таблицы связи;
6. Из stage и таблиц хабов загружаются таблицы сателлиты.
